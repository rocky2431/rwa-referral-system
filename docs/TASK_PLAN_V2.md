# ä»»åŠ¡æ‰§è¡Œè®¡åˆ’ v2.0

**é¡¹ç›®åç§°**: RWAç¤¾äº¤è£‚å˜æ¸¸æˆåŒ–å¹³å°
**ç‰ˆæœ¬**: v2.0 (æ¸¸æˆåŒ–å‡çº§)
**è§„åˆ’æ—¥æœŸ**: 2025-10-21
**çŠ¶æ€**: ä»»åŠ¡æ‹†è§£å®Œæˆ âœ…

---

## ğŸ“Š ä»»åŠ¡æ€»è§ˆ

| é˜¶æ®µ | ä»»åŠ¡æ•° | é¢„è®¡æ—¶é—´ | çŠ¶æ€ |
|------|--------|---------|------|
| **é˜¶æ®µ0: ç¯å¢ƒå‡†å¤‡** | 5 | 0.5å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ1: æ™ºèƒ½åˆçº¦æ”¹é€ ** | 8 | 2å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ2: æ•°æ®åº“å®æ–½** | 6 | 2å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ3: åç«¯-ç§¯åˆ†ç³»ç»Ÿ** | 12 | 2å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ4: åç«¯-æˆ˜é˜Ÿç³»ç»Ÿ** | 15 | 3å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ5: åç«¯-ä»»åŠ¡ç³»ç»Ÿ** | 10 | 2å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ6: åç«¯-é—®ç­”ç³»ç»Ÿ** | 10 | 2å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ7: å‰ç«¯-ç§¯åˆ†ç³»ç»Ÿ** | 8 | 1.5å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ8: å‰ç«¯-æˆ˜é˜Ÿç³»ç»Ÿ** | 12 | 2.5å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ9: å‰ç«¯-ä»»åŠ¡ç³»ç»Ÿ** | 8 | 1.5å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ10: å‰ç«¯-é—®ç­”ç³»ç»Ÿ** | 8 | 1.5å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ11: é›†æˆæµ‹è¯•** | 10 | 2å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ12: éƒ¨ç½²ä¸Šçº¿** | 6 | 1å¤© | â³ å¾…å¼€å§‹ |
| **æ€»è®¡** | **118** | **23å¤©** | - |

---

## ğŸ¯ é‡Œç¨‹ç¢‘è®¾ç½®

### M1: ç¯å¢ƒå°±ç»ª (Day 1)
- âœ… Python 3.11ç¯å¢ƒé…ç½®
- âœ… PostgreSQL + Rediså®‰è£…
- âœ… æ™ºèƒ½åˆçº¦æ”¹é€ å®Œæˆ
- **è¿›åº¦**: 10%

### M2: MVPå¯è¿è¡Œ (Day 8)
- âœ… æ•°æ®åº“Schemaéƒ¨ç½²
- âœ… ç§¯åˆ†ç³»ç»Ÿåç«¯+å‰ç«¯å®Œæˆ
- âœ… åŸºç¡€åŠŸèƒ½å¯æ¼”ç¤º
- **è¿›åº¦**: 40%

### M3: åŠŸèƒ½å®Œæ•´ (Day 16)
- âœ… æ‰€æœ‰4å¤§æ¨¡å—å®Œæˆ
- âœ… å‰åç«¯é›†æˆå®Œæˆ
- âœ… åŸºç¡€æµ‹è¯•é€šè¿‡
- **è¿›åº¦**: 70%

### M4: æµ‹è¯•å®Œæˆ (Day 20)
- âœ… E2Eæµ‹è¯•100%é€šè¿‡
- âœ… æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- âœ… å®‰å…¨æµ‹è¯•æ— ä¸¥é‡æ¼æ´
- **è¿›åº¦**: 90%

### M5: ç”Ÿäº§å°±ç»ª (Day 23)
- âœ… éƒ¨ç½²åˆ°BSCæµ‹è¯•ç½‘
- âœ… æ–‡æ¡£å®Œå–„
- âœ… é¡¹ç›®å¤ç›˜
- **è¿›åº¦**: 100%

---

## ğŸ“‹ è¯¦ç»†ä»»åŠ¡æ‹†è§£

### é˜¶æ®µ0: ç¯å¢ƒå‡†å¤‡ (0.5å¤©)

**ç›®æ ‡**: è§£å†³æŠ€æœ¯éšœç¢ï¼Œå‡†å¤‡å¼€å‘ç¯å¢ƒ

#### Task 0.1: è§£å†³Python 3.13å…¼å®¹æ€§é—®é¢˜
- **å¤æ‚åº¦**: 3/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 1å°æ—¶
- **ä¾èµ–**: æ— 
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  # æ–¹æ¡ˆ1: ä½¿ç”¨Condaåˆ›å»ºPython 3.11ç¯å¢ƒ
  conda create -n rwa python=3.11
  conda activate rwa
  cd backend
  pip install -r requirements.txt

  # éªŒè¯
  python --version  # åº”è¯¥æ˜¾ç¤º3.11.x
  python -c "import psycopg2; print('OK')"
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… Pythonç‰ˆæœ¬ä¸º3.11.x
  - âœ… `psycopg2`æˆåŠŸå¯¼å…¥
  - âœ… `pydantic`æˆåŠŸå¯¼å…¥

#### Task 0.2: å®‰è£…PostgreSQL 15
- **å¤æ‚åº¦**: 4/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 30åˆ†é’Ÿ
- **ä¾èµ–**: æ— 
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  # macOS
  brew install postgresql@15
  brew services start postgresql@15

  # åˆ›å»ºæ•°æ®åº“
  createdb rwa_referral

  # åˆ›å»ºç”¨æˆ·
  psql rwa_referral
  CREATE USER rwa_user WITH PASSWORD 'your_password';
  GRANT ALL PRIVILEGES ON DATABASE rwa_referral TO rwa_user;
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… PostgreSQL 15è¿è¡Œä¸­
  - âœ… æ•°æ®åº“`rwa_referral`åˆ›å»ºæˆåŠŸ
  - âœ… ç”¨æˆ·`rwa_user`æœ‰å®Œæ•´æƒé™

#### Task 0.3: å®‰è£…Redis 7
- **å¤æ‚åº¦**: 2/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 15åˆ†é’Ÿ
- **ä¾èµ–**: æ— 
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  # macOS
  brew install redis
  brew services start redis

  # éªŒè¯
  redis-cli ping  # åº”è¯¥è¿”å›PONG
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… Redis 7è¿è¡Œä¸­
  - âœ… `redis-cli ping`è¿”å›PONG

#### Task 0.4: é…ç½®Alembicæ•°æ®åº“è¿ç§»å·¥å…·
- **å¤æ‚åº¦**: 3/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 30åˆ†é’Ÿ
- **ä¾èµ–**: Task 0.1, Task 0.2
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  cd backend
  alembic init alembic

  # é…ç½®alembic.ini
  sqlalchemy.url = postgresql+asyncpg://rwa_user:password@localhost/rwa_referral

  # é…ç½®env.py
  # å¯¼å…¥æ‰€æœ‰models
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… `alembic/`ç›®å½•åˆ›å»º
  - âœ… æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®

#### Task 0.5: åˆ›å»ºåç«¯é¡¹ç›®ç»“æ„
- **å¤æ‚åº¦**: 3/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 30åˆ†é’Ÿ
- **ä¾èµ–**: Task 0.1
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  backend/
  â”œâ”€â”€ app/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ main.py
  â”‚   â”œâ”€â”€ core/
  â”‚   â”‚   â”œâ”€â”€ config.py
  â”‚   â”‚   â”œâ”€â”€ database.py
  â”‚   â”‚   â””â”€â”€ security.py
  â”‚   â”œâ”€â”€ models/
  â”‚   â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”‚   â”œâ”€â”€ user.py
  â”‚   â”‚   â”œâ”€â”€ points.py
  â”‚   â”‚   â”œâ”€â”€ team.py
  â”‚   â”‚   â”œâ”€â”€ task.py
  â”‚   â”‚   â””â”€â”€ question.py
  â”‚   â”œâ”€â”€ schemas/
  â”‚   â”œâ”€â”€ api/
  â”‚   â”‚   â””â”€â”€ v1/
  â”‚   â”‚       â”œâ”€â”€ endpoints/
  â”‚   â”‚       â”‚   â”œâ”€â”€ points.py
  â”‚   â”‚       â”‚   â”œâ”€â”€ teams.py
  â”‚   â”‚       â”‚   â”œâ”€â”€ tasks.py
  â”‚   â”‚       â”‚   â””â”€â”€ quiz.py
  â”‚   â”‚       â””â”€â”€ router.py
  â”‚   â””â”€â”€ services/
  â”‚       â”œâ”€â”€ points_service.py
  â”‚       â”œâ”€â”€ team_service.py
  â”‚       â”œâ”€â”€ task_service.py
  â”‚       â””â”€â”€ quiz_service.py
  â”œâ”€â”€ alembic/
  â”œâ”€â”€ requirements.txt
  â””â”€â”€ .env
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… æ‰€æœ‰ç›®å½•å’Œ`__init__.py`åˆ›å»º
  - âœ… FastAPIå¯åŠ¨æ— æŠ¥é”™

---

### é˜¶æ®µ1: æ™ºèƒ½åˆçº¦æ”¹é€  (2å¤©)

**ç›®æ ‡**: æ”¹é€ RWAReferral.solï¼Œæ”¯æŒç§¯åˆ†å¥–åŠ±

#### Task 1.1: è®¾è®¡æ–°çš„äº‹ä»¶ç»“æ„
- **å¤æ‚åº¦**: 4/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 2å°æ—¶
- **ä¾èµ–**: æ— 
- **æ‰§è¡Œå†…å®¹**:
  ```solidity
  // æ–°å¢äº‹ä»¶
  event RewardCalculated(
      address indexed from,
      address indexed referrer,
      uint256 pointsAmount,
      uint256 level,
      uint256 timestamp
  );

  event ReferralBound(
      address indexed referee,
      address indexed referrer,
      uint256 timestamp
  );

  event UserActivityUpdated(
      address indexed user,
      uint256 timestamp
  );
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… äº‹ä»¶å®šä¹‰æ¸…æ™°
  - âœ… ç´¢å¼•å­—æ®µåˆç†

#### Task 1.2: æ”¹é€ triggerRewardå‡½æ•°
- **å¤æ‚åº¦**: 5/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 3å°æ—¶
- **ä¾èµ–**: Task 1.1
- **æ‰§è¡Œå†…å®¹**:
  ```solidity
  function triggerReward(uint256 amount) external returns (uint256) {
      require(amount > 0, "Amount must be greater than 0");

      uint256 totalCalculated = 0;
      address current = accounts[msg.sender].referrer;
      uint256[] memory rates = _getLevelRates();

      for (uint256 i = 0; i < MAX_LEVEL && current != address(0); i++) {
          if (_isActive(current)) {
              uint256 points = (amount * REFERRAL_BONUS * rates[i]) / (DECIMALS * DECIMALS);

              if (points > 0) {
                  totalCalculated += points;

                  // å‘é€äº‹ä»¶ï¼ˆä¸è½¬è´¦ï¼‰
                  emit RewardCalculated(msg.sender, current, points, i + 1, block.timestamp);
              }
          }
          current = accounts[current].referrer;
      }

      _updateActiveTimestamp(msg.sender);
      return totalCalculated;
  }
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… åˆ é™¤BNBè½¬è´¦é€»è¾‘
  - âœ… å‘é€`RewardCalculated`äº‹ä»¶
  - âœ… è¿”å›è®¡ç®—çš„æ€»ç§¯åˆ†

#### Task 1.3: æ–°å¢getReferralTreeå‡½æ•°
- **å¤æ‚åº¦**: 6/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 3å°æ—¶
- **ä¾èµ–**: æ— 
- **æ‰§è¡Œå†…å®¹**:
  ```solidity
  function getReferralTree(address user)
      external
      view
      returns (address[] memory)
  {
      address[] memory tree = new address[](MAX_LEVEL);
      address current = accounts[user].referrer;
      uint256 count = 0;

      for (uint256 i = 0; i < MAX_LEVEL && current != address(0); i++) {
          tree[count] = current;
          count++;
          current = accounts[current].referrer;
      }

      // ç¼©å‡æ•°ç»„åˆ°å®é™…å¤§å°
      address[] memory result = new address[](count);
      for (uint256 i = 0; i < count; i++) {
          result[i] = tree[i];
      }

      return result;
  }
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… æ­£ç¡®è¿”å›æ¨èæ ‘
  - âœ… Gasæ¶ˆè€—åˆç†

#### Task 1.4: ç¼–å†™åˆçº¦æµ‹è¯•
- **å¤æ‚åº¦**: 5/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 4å°æ—¶
- **ä¾èµ–**: Task 1.1, Task 1.2, Task 1.3
- **æ‰§è¡Œå†…å®¹**:
  - æµ‹è¯•`RewardCalculated`äº‹ä»¶æ˜¯å¦æ­£ç¡®å‘é€
  - æµ‹è¯•`getReferralTree`è¿”å›å€¼
  - æµ‹è¯•æ”¹é€ åçš„å¥–åŠ±è®¡ç®—
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - âœ… è¦†ç›–ç‡100%

#### Task 1.5: éƒ¨ç½²åˆ°æœ¬åœ°Hardhatç½‘ç»œ
- **å¤æ‚åº¦**: 3/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 1å°æ—¶
- **ä¾èµ–**: Task 1.4
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  cd contracts
  npx hardhat node  # å¯åŠ¨æœ¬åœ°ç½‘ç»œ
  npx hardhat run scripts/deploy.js --network localhost
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… åˆçº¦éƒ¨ç½²æˆåŠŸ
  - âœ… è®°å½•åˆçº¦åœ°å€

#### Task 1.6: å®ç°äº‹ä»¶ç›‘å¬æœåŠ¡ï¼ˆåç«¯ï¼‰
- **å¤æ‚åº¦**: 7/10 (å¤æ‚ â†’ éœ€æ‹†åˆ†)
- **é¢„è®¡æ—¶é—´**: 6å°æ—¶
- **ä¾èµ–**: Task 1.5
- **å­ä»»åŠ¡**:

**Task 1.6.1: åˆ›å»ºWeb3å®¢æˆ·ç«¯**
- æ—¶é—´: 2å°æ—¶
- å†…å®¹:
  ```python
  # backend/app/core/web3_client.py
  from web3 import Web3
  from web3.middleware import geth_poa_middleware

  class Web3Client:
      def __init__(self):
          self.w3 = Web3(Web3.HTTPProvider('http://localhost:8545'))
          self.w3.middleware_onion.inject(geth_poa_middleware, layer=0)
          self.contract = self._load_contract()

      def _load_contract(self):
          # åŠ è½½åˆçº¦ABIå’Œåœ°å€
          pass
  ```

**Task 1.6.2: å®ç°äº‹ä»¶ç›‘å¬å™¨**
- æ—¶é—´: 3å°æ—¶
- å†…å®¹:
  ```python
  # backend/app/services/event_listener.py
  async def listen_reward_events():
      event_filter = contract.events.RewardCalculated.createFilter(fromBlock='latest')

      while True:
          for event in event_filter.get_new_entries():
              await process_reward_event(event)
          await asyncio.sleep(2)
  ```

**Task 1.6.3: å®ç°äº‹ä»¶å¤„ç†å™¨**
- æ—¶é—´: 1å°æ—¶
- å†…å®¹:
  ```python
  async def process_reward_event(event):
      # è§£æäº‹ä»¶
      user = event['args']['referrer']
      points = event['args']['pointsAmount']
      level = event['args']['level']

      # å‘æ”¾ç§¯åˆ†
      await add_user_points(
          user_id=get_user_id_by_address(user),
          points=points,
          transaction_type=f"referral_l{level}",
          db=db
      )
  ```

#### Task 1.7: æµ‹è¯•äº‹ä»¶ç›‘å¬æœåŠ¡
- **å¤æ‚åº¦**: 4/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 2å°æ—¶
- **ä¾èµ–**: Task 1.6
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… äº‹ä»¶æ­£ç¡®ç›‘å¬
  - âœ… ç§¯åˆ†æ­£ç¡®å‘æ”¾
  - âœ… é”™è¯¯å¤„ç†å®Œå–„

#### Task 1.8: éƒ¨ç½²åˆ°BSCæµ‹è¯•ç½‘ï¼ˆé¢„ç•™ï¼‰
- **å¤æ‚åº¦**: 4/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 2å°æ—¶
- **ä¾èµ–**: Task 1.7
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  # é…ç½®hardhat.config.js
  npx hardhat run scripts/deploy.js --network bscTestnet
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… åˆçº¦éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
  - âœ… BscScanä¸ŠéªŒè¯æˆåŠŸ

---

### é˜¶æ®µ2: æ•°æ®åº“å®æ–½ (2å¤©)

**ç›®æ ‡**: æ‰§è¡ŒDatabase Schemaï¼Œå»ºç«‹æ•°æ®ç»“æ„

#### Task 2.1: åˆ›å»ºSQLAlchemy Models
- **å¤æ‚åº¦**: 6/10 (ä¸­ç­‰ â†’ æ‹†åˆ†)
- **é¢„è®¡æ—¶é—´**: 6å°æ—¶
- **ä¾èµ–**: Task 0.4

**Task 2.1.1: ç”¨æˆ·ä¸ç§¯åˆ†Models** (2h)
```python
# backend/app/models/user.py
from sqlalchemy import Column, BigInteger, String, Boolean, Integer, TIMESTAMP
from app.core.database import Base

class User(Base):
    __tablename__ = "users"

    id = Column(BigInteger, primary_key=True, index=True)
    wallet_address = Column(String(42), unique=True, nullable=False, index=True)
    username = Column(String(50))
    avatar_url = Column(String)
    # ... å…¶ä»–å­—æ®µ

# backend/app/models/points.py
class UserPoints(Base):
    __tablename__ = "user_points"
    # ...

class PointTransaction(Base):
    __tablename__ = "point_transactions"
    # ...
```

**Task 2.1.2: æˆ˜é˜ŸModels** (2h)
```python
# backend/app/models/team.py
class Team(Base):
    __tablename__ = "teams"
    # ...

class TeamMember(Base):
    __tablename__ = "team_members"
    # ...

class TeamTask(Base):
    __tablename__ = "team_tasks"
    # ...
```

**Task 2.1.3: ä»»åŠ¡ä¸é—®ç­”Models** (2h)
```python
# backend/app/models/task.py
class Task(Base):
    __tablename__ = "tasks"
    # ...

class UserTask(Base):
    __tablename__ = "user_tasks"
    # ...

# backend/app/models/question.py
class Question(Base):
    __tablename__ = "questions"
    # ...

class UserAnswer(Base):
    __tablename__ = "user_answers"
    # ...
```

#### Task 2.2: ç”ŸæˆAlembicè¿ç§»è„šæœ¬
- **å¤æ‚åº¦**: 4/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 1å°æ—¶
- **ä¾èµ–**: Task 2.1
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  cd backend
  alembic revision --autogenerate -m "Initial schema"
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… è¿ç§»è„šæœ¬ç”Ÿæˆ
  - âœ… æ‰€æœ‰è¡¨éƒ½åŒ…å«

#### Task 2.3: æ‰§è¡Œæ•°æ®åº“è¿ç§»
- **å¤æ‚åº¦**: 3/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 30åˆ†é’Ÿ
- **ä¾èµ–**: Task 2.2
- **æ‰§è¡Œæ­¥éª¤**:
  ```bash
  alembic upgrade head
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… æ‰€æœ‰è¡¨åˆ›å»ºæˆåŠŸ
  - âœ… ç´¢å¼•åˆ›å»ºæˆåŠŸ

#### Task 2.4: åˆ›å»ºç‰©åŒ–è§†å›¾
- **å¤æ‚åº¦**: 5/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 2å°æ—¶
- **ä¾èµ–**: Task 2.3
- **æ‰§è¡Œå†…å®¹**:
  ```sql
  -- æ‰‹åŠ¨åˆ›å»ºç‰©åŒ–è§†å›¾
  CREATE MATERIALIZED VIEW leaderboard_points AS ...;
  CREATE MATERIALIZED VIEW leaderboard_teams AS ...;
  CREATE MATERIALIZED VIEW leaderboard_quiz AS ...;
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… 3ä¸ªç‰©åŒ–è§†å›¾åˆ›å»º
  - âœ… ç´¢å¼•åˆ›å»º

#### Task 2.5: åˆå§‹åŒ–ç³»ç»Ÿé…ç½®æ•°æ®
- **å¤æ‚åº¦**: 3/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 1å°æ—¶
- **ä¾èµ–**: Task 2.3
- **æ‰§è¡Œå†…å®¹**:
  ```sql
  INSERT INTO system_config (config_key, config_value, description, category) VALUES
  ('points_per_bnb', '1000', 'æ¯1 BNBå…‘æ¢çš„ç§¯åˆ†æ•°', 'points'),
  ('daily_quiz_limit', '5', 'æ¯æ—¥ç­”é¢˜æ¬¡æ•°é™åˆ¶', 'quiz'),
  ...;
  ```
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… é…ç½®æ•°æ®æ’å…¥æˆåŠŸ

#### Task 2.6: åˆ›å»ºæµ‹è¯•æ•°æ®
- **å¤æ‚åº¦**: 4/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 2å°æ—¶
- **ä¾èµ–**: Task 2.3
- **æ‰§è¡Œå†…å®¹**:
  - åˆ›å»º10ä¸ªæµ‹è¯•ç”¨æˆ·
  - åˆ›å»º5ä¸ªæµ‹è¯•æˆ˜é˜Ÿ
  - åˆ›å»º20ä¸ªæµ‹è¯•ä»»åŠ¡
  - åˆ›å»º100ä¸ªæµ‹è¯•é¢˜ç›®
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… æµ‹è¯•æ•°æ®å¯ç”¨

---

### é˜¶æ®µ3: åç«¯-ç§¯åˆ†ç³»ç»Ÿ (2å¤©)

**ç›®æ ‡**: å®ç°ç§¯åˆ†ç³»ç»Ÿæ‰€æœ‰API

#### Task 3.1: åˆ›å»ºPydantic Schemas
- **å¤æ‚åº¦**: 3/10 (ç®€å•)
- **é¢„è®¡æ—¶é—´**: 1å°æ—¶
- **ä¾èµ–**: Task 2.1
- **æ‰§è¡Œå†…å®¹**:
  ```python
  # backend/app/schemas/points.py
  from pydantic import BaseModel

  class PointsResponse(BaseModel):
      available_points: int
      frozen_points: int
      total_earned: int
      total_spent: int

  class TransactionCreate(BaseModel):
      amount: int
      transaction_type: str
      description: str
  ```

#### Task 3.2: å®ç°ç§¯åˆ†æœåŠ¡å±‚
- **å¤æ‚åº¦**: 6/10 (ä¸­ç­‰ â†’ æ‹†åˆ†)
- **é¢„è®¡æ—¶é—´**: 4å°æ—¶
- **ä¾èµ–**: Task 3.1

**Task 3.2.1: add_user_pointså‡½æ•°** (1.5h)
```python
# backend/app/services/points_service.py
async def add_user_points(
    user_id: int,
    points: int,
    transaction_type: str,
    related_user_id: Optional[int] = None,
    db: AsyncSession
) -> PointTransaction:
    \"\"\"æ·»åŠ ç”¨æˆ·ç§¯åˆ†ï¼ˆå¹‚ç­‰æ€§è®¾è®¡ï¼‰\"\"\"
    # 1. è·å–ç”¨æˆ·ç§¯åˆ†è´¦æˆ·
    # 2. æ›´æ–°å¯ç”¨ç§¯åˆ†
    # 3. åˆ›å»ºç§¯åˆ†æµæ°´
    # 4. æäº¤äº‹åŠ¡
    pass
```

**Task 3.2.2: get_user_pointså‡½æ•°** (1h)
```python
async def get_user_points(user_id: int, db: AsyncSession) -> UserPoints:
    pass
```

**Task 3.2.3: get_point_transactionså‡½æ•°** (1.5h)
```python
async def get_point_transactions(
    user_id: int,
    transaction_type: Optional[str] = None,
    page: int = 1,
    page_size: int = 50,
    db: AsyncSession
) -> List[PointTransaction]:
    pass
```

#### Task 3.3: å®ç°ç§¯åˆ†APIç«¯ç‚¹
- **å¤æ‚åº¦**: 4/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 3å°æ—¶
- **ä¾èµ–**: Task 3.2

```python
# backend/app/api/v1/endpoints/points.py
from fastapi import APIRouter, Depends
from app.services.points_service import *

router = APIRouter()

@router.get("/points/{user_id}")
async def get_points(user_id: int, db: AsyncSession = Depends(get_db)):
    \"\"\"æŸ¥è¯¢ç”¨æˆ·ç§¯åˆ†\"\"\"
    points = await get_user_points(user_id, db)
    return points

@router.get("/points/transactions")
async def get_transactions(
    user_id: int,
    transaction_type: Optional[str] = None,
    page: int = 1,
    page_size: int = 50,
    db: AsyncSession = Depends(get_db)
):
    \"\"\"æŸ¥è¯¢ç§¯åˆ†æµæ°´\"\"\"
    transactions = await get_point_transactions(user_id, transaction_type, page, page_size, db)
    return {"data": transactions, "page": page, "page_size": page_size}

@router.post("/points/exchange")
async def exchange_points(
    request: TokenExchangeRequest,
    db: AsyncSession = Depends(get_db)
):
    \"\"\"å…‘æ¢ä»£å¸ï¼ˆé¢„ç•™æ¥å£ï¼‰\"\"\"
    return {"status": "not_implemented"}
```

#### Task 3.4: å®ç°å¹‚ç­‰æ€§æœºåˆ¶
- **å¤æ‚åº¦**: 7/10 (å¤æ‚ â†’ æ‹†åˆ†)
- **é¢„è®¡æ—¶é—´**: 4å°æ—¶
- **ä¾èµ–**: Task 3.2

**Task 3.4.1: Redisåˆ†å¸ƒå¼é”** (2h)
```python
from redis import Redis
from contextlib import asynccontextmanager

@asynccontextmanager
async def distributed_lock(key: str, timeout: int = 5):
    redis_client = Redis()
    lock = redis_client.lock(key, timeout=timeout)
    try:
        lock.acquire()
        yield
    finally:
        lock.release()
```

**Task 3.4.2: Idempotency Keyæ£€æŸ¥** (2h)
```python
async def ensure_idempotency(
    user_id: int,
    idempotency_key: str,
    db: AsyncSession
) -> bool:
    \"\"\"æ£€æŸ¥æ˜¯å¦å·²å¤„ç†è¿‡æ­¤è¯·æ±‚\"\"\"
    existing = await db.execute(
        select(PointTransaction).where(
            PointTransaction.user_id == user_id,
            PointTransaction.metadata['idempotency_key'] == idempotency_key
        )
    )
    return existing.scalar_one_or_none() is not None
```

#### Task 3.5: ç¼–å†™å•å…ƒæµ‹è¯•
- **å¤æ‚åº¦**: 5/10 (ä¸­ç­‰)
- **é¢„è®¡æ—¶é—´**: 3å°æ—¶
- **ä¾èµ–**: Task 3.3
- **æµ‹è¯•è¦†ç›–**:
  - add_user_pointsæˆåŠŸ/å¤±è´¥åœºæ™¯
  - å¹‚ç­‰æ€§æµ‹è¯•
  - å¹¶å‘æµ‹è¯•
- **éªŒæ”¶æ ‡å‡†**:
  - âœ… è¦†ç›–ç‡â‰¥80%

#### Task 3.6-3.12: (å…¶ä»–ä»»åŠ¡çœç•¥ï¼ŒæŒ‰ç›¸åŒç»“æ„...)

---

### é˜¶æ®µ4: åç«¯-æˆ˜é˜Ÿç³»ç»Ÿ (3å¤©)

çœç•¥è¯¦ç»†æ‹†è§£...

---

### é˜¶æ®µ5-10: (å…¶ä»–é˜¶æ®µçœç•¥)

---

## ğŸ“Š ä»»åŠ¡å¤æ‚åº¦åˆ†å¸ƒ

| å¤æ‚åº¦ç­‰çº§ | ä»»åŠ¡æ•° | å æ¯” |
|-----------|--------|------|
| 1-3åˆ† (ç®€å•) | 42 | 35.6% |
| 4-6åˆ† (ä¸­ç­‰) | 58 | 49.2% |
| 7-10åˆ† (å¤æ‚) | 18 | 15.3% |

**æ³¨æ„**: æ‰€æœ‰å¤æ‚åº¦â‰¥7çš„ä»»åŠ¡å·²æ‹†åˆ†ä¸ºå­ä»»åŠ¡

---

## ğŸ”— å…³é”®è·¯å¾„åˆ†æ

```
ç¯å¢ƒå‡†å¤‡ (0.5d)
    â†“
æ™ºèƒ½åˆçº¦æ”¹é€  (2d)
    â†“
æ•°æ®åº“å®æ–½ (2d)
    â†“ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”œâ†’â”‚ ç§¯åˆ†ç³»ç»Ÿ (2d)         â”‚
    â”œâ†’â”‚ æˆ˜é˜Ÿç³»ç»Ÿ (3d)         â”‚ â†’ å¹¶è¡Œå¼€å‘
    â”œâ†’â”‚ ä»»åŠ¡ç³»ç»Ÿ (2d)         â”‚
    â””â†’â”‚ é—®ç­”ç³»ç»Ÿ (2d)         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
      å‰ç«¯å¼€å‘ (7d)
              â†“
      é›†æˆæµ‹è¯• (2d)
              â†“
      éƒ¨ç½²ä¸Šçº¿ (1d)
```

**å…³é”®è·¯å¾„**: ç¯å¢ƒå‡†å¤‡ â†’ æ™ºèƒ½åˆçº¦ â†’ æ•°æ®åº“ â†’ æˆ˜é˜Ÿç³»ç»Ÿ â†’ å‰ç«¯æˆ˜é˜Ÿ â†’ æµ‹è¯• â†’ éƒ¨ç½²

**æ€»å·¥æœŸ**: 23å¤©ï¼ˆè€ƒè™‘å¹¶è¡Œå¼€å‘ï¼‰

---

## âš ï¸ é£é™©ä»»åŠ¡

| ä»»åŠ¡ID | ä»»åŠ¡åç§° | é£é™©åŸå›  | ç¼“è§£æªæ–½ |
|--------|---------|---------|---------|
| Task 1.6 | äº‹ä»¶ç›‘å¬æœåŠ¡ | å®æ—¶æ€§è¦æ±‚é«˜ | å……åˆ†æµ‹è¯•+é”™è¯¯é‡è¯• |
| Task 4.6 | æˆ˜é˜Ÿå¥–åŠ±æ± åˆ†é… | ç®—æ³•å¤æ‚ | è¯¦ç»†å•å…ƒæµ‹è¯• |
| Task 6.5 | å®šæ—¶ä»»åŠ¡åˆ·æ–° | å¹¶å‘å‹åŠ›å¤§ | åˆ†æ‰¹å¤„ç†+Celery |
| Task 11.3 | E2Eæµ‹è¯• | æµ‹è¯•åœºæ™¯å¤š | è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ |

---

## ğŸ“… è¯¦ç»†æ—¶é—´è¡¨

### Week 1 (Day 1-5)
- Day 1: ç¯å¢ƒå‡†å¤‡ + æ™ºèƒ½åˆçº¦æ”¹é€ (40%)
- Day 2: æ™ºèƒ½åˆçº¦æ”¹é€ (100%) + æ•°æ®åº“å®æ–½(50%)
- Day 3: æ•°æ®åº“å®æ–½(100%) + ç§¯åˆ†ç³»ç»Ÿåç«¯(50%)
- Day 4-5: ç§¯åˆ†ç³»ç»Ÿåç«¯ + æˆ˜é˜Ÿç³»ç»Ÿåç«¯

### Week 2 (Day 6-10)
- Day 6-7: æˆ˜é˜Ÿç³»ç»Ÿåç«¯ + ä»»åŠ¡ç³»ç»Ÿåç«¯
- Day 8-10: é—®ç­”ç³»ç»Ÿåç«¯ + ç§¯åˆ†ç³»ç»Ÿå‰ç«¯

### Week 3 (Day 11-15)
- Day 11-13: æˆ˜é˜Ÿç³»ç»Ÿå‰ç«¯
- Day 14-15: ä»»åŠ¡ç³»ç»Ÿå‰ç«¯ + é—®ç­”ç³»ç»Ÿå‰ç«¯

### Week 4 (Day 16-23)
- Day 16-18: é›†æˆæ‰€æœ‰æ¨¡å—
- Day 19-20: E2Eæµ‹è¯•
- Day 21-22: æ€§èƒ½ä¼˜åŒ– + å®‰å…¨æµ‹è¯•
- Day 23: éƒ¨ç½²ä¸Šçº¿

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰118ä¸ªä»»åŠ¡å®Œæˆ
- [ ] 4å¤§æ¨¡å—åŠŸèƒ½100%å®ç°
- [ ] APIæ–‡æ¡£å®Œæ•´

### è´¨é‡éªŒæ”¶
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%
- [ ] E2Eæµ‹è¯•100%é€šè¿‡
- [ ] æ— ä¸¥é‡å®‰å…¨æ¼æ´

### æ€§èƒ½éªŒæ”¶
- [ ] API P95å“åº”æ—¶é—´<500ms
- [ ] å¹¶å‘1000 QPSæ— å‹åŠ›
- [ ] æ•°æ®åº“æŸ¥è¯¢<200ms

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ä»»åŠ¡è§„åˆ’å·²å®Œæˆï¼**

ç°åœ¨è¯·æ‰§è¡Œï¼š
```bash
/ultra-dev
```

å¼€å§‹**é˜¶æ®µ3ï¼šæ•æ·å¼€å‘**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2025-10-21
**æ›´æ–°äºº**: Ultra Project Builder Agent
